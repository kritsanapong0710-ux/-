<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>LOMNUER ‚Äî Love Love Mystery Club Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@200;300;400;600&display=swap" rel="stylesheet">
<style>
:root {
    --primary: #ff2d55;
    --secondary: #7042f8;
    --accent: #00f2ff;
    --bg-dark: #0a0a0c;
    --glass: rgba(15, 15, 20, 0.85);
    --font-main: 'Prompt', sans-serif;
}

* { font-family: var(--font-main); box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html, body { height: 100%; width: 100%; margin: 0; background: #000; color: #fff; overflow: hidden; }

/* Fade transition */
#fadeLayer { position: fixed; inset: 0; background: #000; z-index: 9999; pointer-events: none; opacity: 0; transition: opacity .8s; }

/* Top Navigation (Show only on Map) */
#topUI { 
    position: fixed; top: 0; left: 0; width: 100%; z-index: 500; 
    display: none; flex-direction: column; align-items: center; 
    padding: 20px; pointer-events: none; 
}
#timeline { display: flex; gap: 12px; margin-bottom: 15px; }
.tl-step { 
    background: rgba(0,0,0,0.6); padding: 8px 16px; border-radius: 20px; 
    font-size: 0.8rem; border: 1px solid rgba(255,255,255,0.1); color: #888; 
}
.tl-step.active { 
    background: var(--primary); color: #fff; border-color: #fff; 
    box-shadow: 0 0 15px var(--primary); font-weight: 600;
}

#globalStatus { display: flex; align-items: center; gap: 15px; pointer-events: auto; }
.day-box { 
    background: linear-gradient(90deg, var(--primary), var(--secondary)); 
    padding: 8px 24px; border-radius: 12px; font-weight: 700; font-size: 1.1rem; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.4); 
}
.time-box { font-size: 1rem; letter-spacing: 2px; border-left: 2px solid var(--primary); padding-left: 15px; color: #eee; }

/* Screens */
.screen { position: absolute; inset: 0; display: none; background-size: cover; background-position: center; flex-direction: column; }
.active { display: flex; }

/* Lobby UI */
#lobby { background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤lobby.jpg') center/cover; align-items: center; justify-content: center; }
.play-btn { 
    width: 150px; height: 150px; border-radius: 50%; border: 4px solid #fff; 
    background: rgba(255, 45, 85, 0.2); color: #fff; font-size: 24px; font-weight: 700; 
    cursor: pointer; backdrop-filter: blur(8px); transition: 0.4s; 
    animation: pulse-btn 2s infinite;
}
.play-btn:hover { transform: scale(1.1); background: var(--primary); }

/* Map Markers */
#map-screen { background: url('map.jpg') center/cover; }
.map-marker { 
    position: absolute; width: 56px; height: 56px; border-radius: 50%; 
    background: var(--primary); border: 3px solid #fff; display: flex; 
    align-items: center; justify-content: center; font-weight: 800; 
    cursor: pointer; box-shadow: 0 0 25px var(--primary); 
    animation: marker-float 1.5s infinite alternate; 
}

/* Profile Modal */
#profileModal { 
    position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); 
    width: 380px; background: var(--glass); backdrop-filter: blur(20px); 
    padding: 30px; border-radius: 24px; display: none; 
    border: 1px solid rgba(255,255,255,0.15); z-index: 1000; text-align: center; 
}
.pf-avatar { width: 130px; height: 130px; border-radius: 50%; margin: 0 auto 20px; border: 4px solid var(--primary); background-size: cover; background-position: center; }
.pf-name { font-size: 1.6rem; font-weight: 700; color: #fff; margin-bottom: 8px; }
.pf-bio { font-size: 0.95rem; color: #bbb; margin-bottom: 25px; line-height: 1.5; }
.pf-btns { display: flex; gap: 12px; }
.btn-pf { flex: 1; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; }
.btn-pf.start { background: var(--primary); color: #fff; }
.btn-pf.cancel { background: rgba(255,255,255,0.1); color: #fff; }

/* Video & Call */
video { width: 100%; height: 100%; object-fit: cover; }
#call-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(15px); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; }
.call-card { text-align: center; animation: call-shake 0.5s infinite; }
.call-pfp { width: 160px; height: 160px; border-radius: 50%; border: 5px solid #4cd964; margin: 0 auto 25px; background: url('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠.jpg') center/cover; }
.call-btns { display: flex; gap: 50px; margin-top: 40px; }
.c-btn { width: 75px; height: 75px; border-radius: 50%; border: none; font-size: 2rem; color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.c-btn.accept { background: #4cd964; box-shadow: 0 0 20px rgba(76,217,100,0.5); }
.c-btn.decline { background: #ff3b30; box-shadow: 0 0 20px rgba(255,59,48,0.5); }

/* Choice Screen */
#choice-screen { background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.6)), url('‡∏†‡∏≤‡∏û‡∏ô‡∏¥‡πà‡∏á‡∏â‡∏≤‡∏Å‡πÅ‡∏£‡∏Å‡∏ï‡∏≠‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.jpg') center/cover; justify-content: flex-end; padding-bottom: 100px; align-items: center; }
.choice-list { width: 90%; max-width: 450px; display: flex; flex-direction: column; gap: 15px; }
.btn-choice { background: var(--glass); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 20px; border-radius: 15px; cursor: pointer; text-align: center; font-size: 1.05rem; transition: 0.3s; backdrop-filter: blur(10px); }
.btn-choice:hover { background: var(--primary); border-color: #fff; transform: translateY(-3px); }

/* Chat Screen */
#chat-screen { background: #0f1015; }
.chat-head { height: 80px; background: #1a1b22; display: flex; align-items: center; padding: 0 20px; border-bottom: 1px solid #2a2b32; }
.chat-body { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
.msg { padding: 12px 18px; border-radius: 20px; max-width: 75%; line-height: 1.5; font-size: 0.95rem; }
.msg.him { background: #25262e; color: #eee; align-self: flex-start; border-bottom-left-radius: 4px; }
.msg.me { background: var(--primary); color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; }
.chat-input-area { background: #1a1b22; padding: 15px; display: none; flex-direction: column; gap: 10px; }

/* Narration */
#narration { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 8000; display: none; align-items: center; justify-content: center; text-align: center; padding: 50px; font-size: 1.3rem; line-height: 1.8; color: #fff; font-weight: 300; }

/* Result */
#result-screen { justify-content: center; align-items: center; background: #050507; }
.result-card { background: var(--glass); padding: 40px; border-radius: 30px; border: 1px solid var(--primary); width: 85%; text-align: center; }

/* DAM Overlay */
#damOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9000; display: none; align-items: center; justify-content: center; }
.dam-box { width: 85%; max-width: 420px; background: #151518; padding: 25px; border-radius: 25px; border: 1px solid var(--primary); }
.dam-box img { width: 100%; border-radius: 15px; margin-bottom: 20px; }

/* IG */
#ig-screen { background: #000; display: none; align-items: center; justify-content: center; }
.ig-card { width: 100%; max-width: 500px; background: #fff; color: #000; border-radius: 15px; overflow: hidden; }

/* Animations */
@keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 45, 85, 0.6); } 70% { box-shadow: 0 0 0 20px rgba(255, 45, 85, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 45, 85, 0); } }
@keyframes marker-float { from { transform: translateY(0); } to { transform: translateY(-12px); } }
@keyframes call-shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
</style>
</head>
<body>

<div id="fadeLayer"></div>
<div id="narration"></div>

<div id="topUI">
    <div id="timeline">
        <div class="tl-step active" id="tl-1">DAY 01 - ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
        <div class="tl-step" id="tl-2">DAY 02 - ‡πÇ‡∏î‡∏°</div>
    </div>
    <div id="globalStatus">
        <div class="day-box" id="dayText">DAY 01</div>
        <div class="time-box">MORNING</div>
    </div>
</div>

<div id="lobby" class="screen active">
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="letter-spacing: 12px; font-weight: 200; margin: 0; font-size: 3rem;">LOMNUER</h1>
        <p style="color: var(--primary); letter-spacing: 3px; font-size: 0.8rem;">LOVE LOVE MYSTERY CLUB</p>
    </div>
    <button class="play-btn" onclick="startGame()">START</button>
</div>

<div id="map-screen" class="screen">
    <div id="marker-b1" class="map-marker" style="top:51%; left:43%;" onclick="openProfile('‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠','‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠.jpg','‡∏Ñ‡∏ô‡∏ä‡∏≠‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏ï‡∏•‡∏Å ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏™‡∏¥‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô B1', startIntro)">B1</div>
    <div id="marker-dome" class="map-marker" style="top:70%; left:48%; display:none; background:var(--secondary);" onclick="openProfile('‡πÇ‡∏î‡∏°','‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏î‡∏°.jpg','‡∏à‡∏∏‡∏î‡∏ô‡∏±‡∏î‡∏û‡∏ö‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏°‡∏Å‡∏µ‡∏¨‡∏≤ ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ö‡∏≠‡∏Å‡πÑ‡∏ß‡πâ', startDomeEvent)">D</div>

    <div id="profileModal">
        <div class="pf-avatar" id="pfAvatar"></div>
        <div class="pf-name" id="pfName">---</div>
        <div class="pf-bio" id="pfBio">---</div>
        <div class="pf-btns">
            <button class="btn-pf start" id="pfAction">START</button>
            <button class="btn-pf cancel" onclick="closeProfile()">CANCEL</button>
        </div>
    </div>
</div>

<div id="video-screen" class="screen">
    <video id="vPlayer" playsinline></video>
    <div id="call-overlay">
        <div class="call-card">
            <div class="call-pfp"></div>
            <h2 id="callTarget">‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</h2>
            <p style="opacity:0.6; font-size: 0.9rem;">‡∏™‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠...</p>
            <div class="call-btns">
                <button class="c-btn decline" onclick="declineCall()">‚úï</button>
                <button class="c-btn accept" onclick="answerCall()">üì±</button>
            </div>
        </div>
    </div>
</div>

<div id="choice-screen" class="screen">
    <div class="choice-list">
        <button class="btn-choice" onclick="goTo('chat-screen', runChatDay1)">üì± ‡∏ó‡∏±‡∏Å LINE ‡πÑ‡∏õ‡∏à‡∏µ‡∏ö</button>
        <button class="btn-choice" style="color:var(--primary); border-color:var(--primary);" onclick="playPrison()">üëä ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏Å‡∏£‡∏∞‡∏ó‡∏∑‡∏ö‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</button>
    </div>
</div>

<div id="chat-screen" class="screen">
    <div class="chat-head">
        <div id="chatAvatar" style="width:45px; height:45px; border-radius:50%; background:url('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠.jpg') center/cover; margin-right:15px;"></div>
        <div id="chatName" style="font-weight:600; font-size:1.1rem;">‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</div>
    </div>
    <div class="chat-body" id="chatBox"></div>
    <div id="chatInputArea" class="chat-input-area"></div>
</div>

<div id="result-screen" class="screen">
    <div class="result-card">
        <h1 id="resTitle" style="color:var(--primary); font-size:2.2rem;">DAY CLEAR</h1>
        <div id="resBody" style="margin:25px 0; line-height:1.7;"></div>
        <button class="btn-choice" style="width:100%;" onclick="location.reload()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
    </div>
</div>

<div id="damOverlay">
    <div class="dam-box">
        <img src="‡∏î‡∏≥.jpg" alt="‡∏î‡∏≥">
        <div style="display:flex; flex-direction:column; gap:12px;">
            <button class="btn-choice" onclick="chooseDamIG()">1. ‡∏Ç‡∏≠‡πÑ‡∏≠‡∏à‡∏µ‡∏à‡∏≤‡∏Å‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</button>
            <button class="btn-choice" onclick="chooseDamIgnore()">2. ‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à ‡∏î‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏≤‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤</button>
        </div>
    </div>
</div>

<div id="ig-screen" class="screen">
    <div class="ig-card">
        <div style="padding:15px; display:flex; align-items:center; gap:12px; border-bottom:1px solid #eee;">
            <div style="width:40px; height:40px; border-radius:50%; background:url('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏î‡∏≥.jpg') center/cover;"></div>
            <span style="font-weight:700;">dammaybe</span>
        </div>
        <div style="width:100%; height:450px; background:url('‡∏î‡∏≥.jpg') center/cover;"></div>
        <div style="padding:15px;">
            <p><b>dammaybe</b> ‡∏î‡∏≥‡∏à‡∏±‡∏á ‡πÅ‡∏ï‡πà‡∏Å‡πá‡∏´‡∏•‡πà‡∏≠...</p>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn-pf start" style="border-radius:8px;" onclick="openDM()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                <button class="btn-pf cancel" style="border-radius:8px; color:#000;" onclick="goTo('map-screen')">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>
</div>

<audio id="sndBgm" src="https://www.chosic.com/wp-content/uploads/2021/04/Rainy-Day.mp3" loop></audio>
<audio id="sndMsg" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>
<audio id="sndCall" src="https://assets.mixkit.co/active_storage/sfx/1350/1350-preview.mp3" loop></audio>

<script>
const v = document.getElementById('vPlayer');
const f = document.getElementById('fadeLayer');
const nar = document.getElementById('narration');
const bgm = document.getElementById('sndBgm');
const callSnd = document.getElementById('sndCall');
const msgSnd = document.getElementById('sndMsg');

let rel = { lomneua: 85, dam: 0 };
let currentDay = 1;

function goTo(id, callback) {
    f.style.opacity = '1';
    setTimeout(() => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');

        // Logic: Show Top HUD only on Map Screen
        const topUI = document.getElementById('topUI');
        if (id === 'map-screen') {
            topUI.style.display = 'flex';
            document.querySelectorAll('.tl-step').forEach(t => t.classList.remove('active'));
            document.getElementById('tl-' + currentDay).classList.add('active');
        } else {
            topUI.style.display = 'none';
        }

        if (callback) callback();
        f.style.opacity = '0';
    }, 600);
}

function startGame() {
    bgm.play().catch(() => {});
    goTo('map-screen');
}

function openProfile(name, avatar, bio, onStart) {
    document.getElementById('pfName').innerText = name;
    document.getElementById('pfBio').innerText = bio;
    document.getElementById('pfAvatar').style.backgroundImage = `url('${avatar}')`;
    document.getElementById('pfAction').onclick = () => {
        closeProfile();
        onStart();
    };
    document.getElementById('profileModal').style.display = 'block';
}

function closeProfile() { document.getElementById('profileModal').style.display = 'none'; }

// --- DAY 1 FLOWS ---
function startIntro() {
    goTo('video-screen', () => {
        v.src = "‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏£‡∏ß‡∏°‡∏≠‡∏¥‡∏ô‡πÇ‡∏ó‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°.mp4";
        v.load(); v.play();
        v.onended = () => goTo('choice-screen');
    });
}

function playPrison() {
    goTo('video-screen', () => {
        v.src = "‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏∑‡∏ö.mp4";
        v.load(); v.play();
        v.onended = () => {
            alert("‡∏ï‡∏¥‡∏î‡∏Ñ‡∏∏‡∏Å‡∏Ñ‡πà‡∏∞! ‡∏´‡πâ‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ô‡∏∞‡∏Ñ‡∏∞");
            location.reload();
        };
    });
}

async function runChatDay1() {
    const box = document.getElementById('chatBox'); box.innerHTML = '';
    await addMsg('me', '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏Ñ‡∏∞?');
    await addMsg('him', '‡πÉ‡∏ä‡πà‡∏Ñ‡∏£‡∏±‡∏ö ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏´‡∏£‡∏≠ ‡∏ó‡∏±‡∏Å‡∏°‡∏≤‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏à‡∏±‡∏á');
    await addMsg('me', '‡∏´‡∏¢‡∏Å‡πÄ‡∏≠‡∏á‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏≠‡∏ö‡∏°‡∏≠‡∏á‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ 1 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ‡πÑ‡∏á');
    await addMsg('him', '‡∏≠‡πã‡∏≠‡∏≠‡∏≠ ‡∏´‡∏¢‡∏Å‡∏ô‡∏µ‡πà‡πÄ‡∏≠‡∏á ‡∏ô‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏Å‡∏°‡∏≤‡∏ã‡∏∞‡πÅ‡∏•‡πâ‡∏ß');
    showChatOptions([
        { t: '"‡∏Å‡πá‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏±‡πâ‡∏ô ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏•‡πà‡∏∞‡∏Ñ‡∏∞"', next: 1 },
        { t: '"‡∏´‡∏¢‡∏Å‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏±‡∏á"', next: 2 }
    ]);
}

// --- DAY 2 FLOWS (FIXED) ---
function startDay2Transition() {
    currentDay = 2;
    document.getElementById('dayText').innerText = "DAY 02";
    showNarration("‡πÄ‡∏ä‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏°‡∏≤...", () => {
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏•‡πà‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ Day 2 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Narration
        goTo('video-screen', () => {
            v.src = "‡∏ö‡πâ‡∏≤‡∏ô‡∏ú‡∏°1.mp4";
            v.load(); 
            v.play();
            v.onended = () => {
                // ‡πÇ‡∏ä‡∏ß‡πå‡∏™‡∏≤‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏à‡∏ö
                document.getElementById('call-overlay').style.display = 'flex';
                callSnd.play();
            };
        });
    });
}

function answerCall() {
    callSnd.pause();
    document.getElementById('call-overlay').style.display = 'none';
    showChatOptions([
        { t: '"‡∏Æ‡∏±‡∏•‡πÇ‡∏´‡∏•‡∏Ñ‡πà‡∏∞... ‡πÇ‡∏ó‡∏£‡∏°‡∏≤‡∏õ‡∏•‡∏∏‡∏Å‡∏´‡∏¢‡∏Å‡πÄ‡∏´‡∏£‡∏≠‡∏Ñ‡∏∞?"', next: 'call1' },
        { t: '"‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏ô‡∏∞‡∏Ñ‡∏∞‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ ‡∏´‡∏¢‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ï‡∏∑‡πà‡∏ô‡πÄ‡∏≠‡∏á!"', next: 'call2' }
    ]);
}

function declineCall() {
    callSnd.pause();
    document.getElementById('call-overlay').style.display = 'none';
    showNarration("‡∏Ñ‡∏∏‡∏ì‡∏û‡∏•‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠...", () => goTo('map-screen'));
}

function startDomeEvent() {
    goTo('video-screen', () => {
        v.src = "‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ñ‡∏≤‡∏°.mp4";
        v.load(); v.play();
        v.onended = () => {
            // ‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÑ‡∏≠‡πâ‡∏î‡∏≥
            v.src = "‡πÑ‡∏≠‡πâ‡∏î‡∏≥.mp4";
            v.load(); v.play();
            v.onended = () => {
                document.getElementById('damOverlay').style.display = 'flex';
            };
        };
    });
}

function chooseDamIG() {
    document.getElementById('damOverlay').style.display = 'none';
    rel.dam += 40;
    rel.lomneua += 5;
    showNarration("‡πÑ‡∏î‡πâ‡πÑ‡∏≠‡∏à‡∏µ‡πÅ‡∏•‡πâ‡∏ß! ‡πÑ‡∏õ‡∏™‡πà‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏î‡∏≥‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞", () => goTo('ig-screen'));
}

function chooseDamIgnore() {
    document.getElementById('damOverlay').style.display = 'none';
    rel.lomneua -= 30;
    showResultCard("GAME OVER", "‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏≠‡∏≤‡∏î‡∏≥ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏™‡∏ô‡πÉ‡∏à ‡πÄ‡∏Ç‡∏≤‡∏à‡∏∂‡∏á‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì");
    goTo('result-screen');
}

async function openDM() {
    goTo('chat-screen', async () => {
        document.getElementById('chatName').innerText = "‡∏î‡∏≥";
        document.getElementById('chatAvatar').style.backgroundImage = "url('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏î‡∏≥.jpg')";
        const box = document.getElementById('chatBox'); box.innerHTML = '';
        await addMsg('him', '‡πÄ‡∏Æ‡πâ‡∏¢ ‡πÉ‡∏Ñ‡∏£‡πÄ‡∏ô‡∏µ‡πà‡∏¢‡∏°‡∏≤‡∏™‡πà‡∏≠‡∏á?');
        await addMsg('me', '‡∏´‡∏¢‡∏Å‡πÄ‡∏≠‡∏á‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏´‡πá‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ');
        await addMsg('him', '‡πÇ‡∏≠‡πä‡∏∞ ‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏à‡∏±‡∏á ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏°‡∏à‡∏∞‡∏ä‡∏ß‡∏ô‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü');
        await addMsg('me', '‡πÑ‡∏õ‡∏™‡∏¥‡∏Ñ‡∏∞ ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏™‡∏¥');
        await addMsg('him', '‡πÇ‡∏≠‡πÄ‡∏Ñ ‡∏ô‡∏±‡∏î‡∏Ñ‡∏∑‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡∏∞');
        setTimeout(() => {
            showResultCard("DAY 02 CLEAR", "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏î‡∏≥‡πÉ‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤...");
            goTo('result-screen');
        }, 2000);
    });
}

// --- UTILS ---
async function addMsg(side, text) {
    const box = document.getElementById('chatBox');
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.justifyContent = side === 'me' ? 'flex-end' : 'flex-start';
    row.innerHTML = `<div class="msg ${side}">${text}</div>`;
    box.appendChild(row);
    msgSnd.currentTime = 0; msgSnd.play().catch(()=>{});
    box.scrollTop = box.scrollHeight;
    await new Promise(r => setTimeout(r, 1400));
}

function showChatOptions(opts) {
    const area = document.getElementById('chatInputArea');
    area.innerHTML = '';
    opts.forEach(o => {
        const b = document.createElement('button');
        b.className = 'btn-choice';
        b.style.padding = "12px";
        b.innerText = o.t;
        b.onclick = () => {
            area.style.display = 'none';
            handleChoice(o);
        };
        area.appendChild(b);
    });
    area.style.display = 'flex';
}

async function handleChoice(opt) {
    if(typeof opt.next === 'string' && opt.next.startsWith('call')) {
        let response = opt.next === 'call1' ? "‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠: ‡πÉ‡∏ä‡πà‡∏Ñ‡πà‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏°‡∏≤‡∏™‡∏≤‡∏¢‡∏ô‡∏∞!" : "‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠: ‡∏ï‡∏∑‡πà‡∏ô‡∏™‡∏≤‡∏¢‡∏ô‡∏∞‡πÄ‡∏£‡∏≤ ‡∏£‡∏µ‡∏ö‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞";
        showNarration(response, () => {
            showNarration("‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏¢‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÇ‡∏î‡∏°‡∏ô‡∏∞ ‡∏°‡∏≤‡∏´‡∏≤‡πÄ‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢ ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏Ñ‡πà‡∏∞", () => {
                document.getElementById('marker-b1').style.display = 'none';
                document.getElementById('marker-dome').style.display = 'flex';
                goTo('map-screen');
            });
        });
        return;
    }

    await addMsg('me', opt.t);
    if (opt.next === 1) {
        await addMsg('him', '‡∏û‡∏π‡∏î‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏°‡∏±‡πâ‡∏¢‡πÄ‡∏ô‡∏µ‡πà‡∏¢... ‡∏ú‡∏°‡πÄ‡∏Ç‡∏¥‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞');
        await addMsg('him', '‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏°‡∏≤‡∏´‡∏≤‡∏ú‡∏°‡∏≠‡∏µ‡∏Å‡∏°‡∏±‡πâ‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö?');
        showChatOptions([
            { t: '"‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏´‡∏≤ ‡∏´‡∏¢‡∏Å‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞"', next: 3 },
            { t: '"‡∏Ç‡∏≠‡∏î‡∏π‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏à‡∏∞‡πÉ‡∏à‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏´‡∏¢‡∏Å‡∏°‡∏±‡πâ‡∏¢"', next: 3 }
        ]);
    } else if (opt.next === 2) {
        await addMsg('him', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô‡∏•‡πà‡∏∞‡∏Ñ‡∏∞?');
        await addMsg('me', '‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏ñ‡∏∂‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏ô‡∏à‡∏π‡∏á‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞');
        await addMsg('him', '‡πÅ‡∏£‡∏á‡∏ô‡∏∞‡πÄ‡∏£‡∏≤‡∏ô‡πà‡∏∞... ‡∏á‡∏±‡πâ‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏•‡∏≠‡∏á‡∏°‡∏≤‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏™‡∏¥');
        setTimeout(() => {
            showResultCard("DAY 1 CLEAR", "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ô‡∏±‡∏î‡∏Å‡∏±‡∏ö‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠! ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå: " + rel.lomneua + "%");
            goTo('result-screen', () => { currentDay = 2; });
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2
            setTimeout(() => startDay2Transition(), 3000);
        }, 1500);
    } else if (opt.next === 3) {
        await addMsg('him', '‡∏õ‡∏≤‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞... ‡∏á‡∏±‡πâ‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏ô‡∏∞');
        setTimeout(() => {
            showResultCard("DAY 1 CLEAR", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô! ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå: " + rel.lomneua + "%");
            goTo('result-screen');
            setTimeout(() => startDay2Transition(), 3000);
        }, 1500);
    }
}

function showNarration(txt, cb) {
    nar.innerHTML = `<div>${txt}</div>`;
    nar.style.display = 'flex';
    setTimeout(() => {
        nar.style.display = 'none';
        if (cb) cb();
    }, 3000);
}

function showResultCard(title, body) {
    document.getElementById('resTitle').innerText = title;
    document.getElementById('resBody').innerHTML = body + `<br><br><b>Heart Points:</b><br>‡∏•‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡∏≠: ${rel.lomneua} | ‡∏î‡∏≥: ${rel.dam}`;
}
</script>
</body>
</html>

